<UserControl
  x:Class="CTKS_Chart.Views.Trading.ChartLayout"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:controls="clr-namespace:VCore.WPF.Controls;assembly=VCore.WPF"
  xmlns:controls1="clr-namespace:CTKS_Chart.Views.Controls"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:CTKS_Chart.Views.Trading"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d">
  <Grid Background="#ff05080d">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="auto" />
      <ColumnDefinition />
      <ColumnDefinition Width="auto" />
    </Grid.ColumnDefinitions>

    <Grid.RowDefinitions>
      <RowDefinition />
      <RowDefinition Height="auto" />
    </Grid.RowDefinitions>

    <Border
      Width="50"
      Margin="0,0,0,0"
      Padding="0,15,0,0"
      HorizontalAlignment="Left"
      Panel.ZIndex="100"
      Background="#45000000">
      <Grid Margin="0,90,0,0">
        <StackPanel Orientation="Vertical">
          <controls:PathButton
            Margin="0,0,0,10"
            HorizontalAlignment="Center"
            VerticalAlignment="Top"
            Glyph=""
            GlyphFontSize="25"
            IconCheckedColor="{StaticResource YellowColor}"
            IconHeight="auto"
            IconMargin="0"
            IconWidth="auto"
            IsChecked="{Binding ElementName=Overlay, Path=MeasureTool.IsEnabled, Mode=TwoWay}"
            ToolTip="Measure" />

          <StackPanel DataContext="{Binding DrawingSettings}" Orientation="Vertical">
            <controls:PathButton
              Margin="0,10"
              HorizontalAlignment="Center"
              VerticalAlignment="Top"
              Glyph=""
              GlyphFontSize="25"
              IconCheckedColor="{StaticResource YellowColor}"
              IconHeight="auto"
              IconMargin="0"
              IconWidth="auto"
              IsChecked="{Binding ShowIntersections, Mode=TwoWay}"
              ToolTip="Show intersections" />

            <controls:PathButton
              Margin="0,10"
              HorizontalAlignment="Center"
              VerticalAlignment="Top"
              Glyph=""
              GlyphFontSize="25"
              IconCheckedColor="{StaticResource YellowColor}"
              IconHeight="auto"
              IconMargin="0"
              IconWidth="auto"
              IsChecked="{Binding ShowClusters, Mode=TwoWay}"
              ToolTip="Show clusters" />

            <controls:PathButton
              x:Name="show_positions_toggle"
              Margin="0,15"
              HorizontalAlignment="Center"
              Glyph="{StaticResource square-poll-horizontal}"
              GlyphFontSize="25"
              IconCheckedColor="{StaticResource YellowColor}"
              IconDefaultColor="{StaticResource YellowColor}"
              IconHoverColor="{StaticResource YellowColor}"
              IconMargin="0" />


            <Popup
              IsOpen="{Binding ElementName=show_positions_toggle, Path=IsChecked, Mode=TwoWay}"
              Placement="Bottom"
              PlacementTarget="{Binding ElementName=show_positions_toggle}"
              StaysOpen="False">
              <Border Padding="5" Background="#101010">
                <StackPanel Orientation="Vertical">
                  <CheckBox
                    Margin="0,5"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    IsChecked="{Binding ShowAutoPositions}">
                    Show auto positions
                  </CheckBox>


                  <CheckBox
                    Margin="0,5"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    IsChecked="{Binding ShowManualPositions}">
                    Show manual positions
                  </CheckBox>

                </StackPanel>
              </Border>

            </Popup>

          </StackPanel>
        </StackPanel>
      </Grid>
    </Border>

    <controls1:Chart
      x:Name="Chart"
      Grid.Row="0"
      Grid.Column="1"
      DrawingViewModel="{Binding}"
      AssetPriceRound="{Binding TradingBot.Asset.PriceRound}"
      ChartContent="{Binding Chart}"
      ChartHeight="{Binding CanvasHeight, Mode=TwoWay}"
      ChartWidth="{Binding CanvasWidth, Mode=TwoWay}"
      Overlay="{Binding ElementName=Overlay}" />

    <controls1:Overlay
      x:Name="Overlay"
      Grid.RowSpan="2"
      Grid.Column="1"
      Grid.ColumnSpan="2"
      Chart="{Binding ElementName=Chart}"
      HorizontalRuler="{Binding ElementName=HorizontalRuler}"
      VerticalRuler="{Binding ElementName=VerticalRuler}" />

    <controls1:VerticalRuler
      x:Name="VerticalRuler"
      Grid.Row="0"
      Grid.Column="2"
      Width="55"
      Height="{Binding CanvasHeight}"
      HorizontalAlignment="Right"
      VerticalAlignment="Center"
      AssetPriceRound="{Binding TradingBot.Asset.PriceRound}"
      ChartContent="{Binding Chart}"
      LabelsToRender="{Binding RenderedLabels}"
      MaxValue="{Binding MaxValue, Mode=TwoWay}"
      MinValue="{Binding MinValue, Mode=TwoWay}"
      ResetChart="{Binding ResetChartY}"
      ValuesToRender="{Binding RenderedIntersections}">
      <controls1:VerticalRuler.Style>
        <Style TargetType="controls1:VerticalRuler">
          <Style.Triggers>
            <DataTrigger Binding="{Binding DataContext.SelectedBot.IsSimulation, RelativeSource={RelativeSource AncestorType=Window}}" Value="true">
              <Setter Property="Visibility" Value="Hidden" />
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </controls1:VerticalRuler.Style>
    </controls1:VerticalRuler>

    <controls1:HorizontalRuler
      x:Name="HorizontalRuler"
      Grid.Row="1"
      Grid.Column="1"
      Width="{Binding CanvasWidth}"
      Height="22"
      HorizontalAlignment="Center"
      VerticalAlignment="Bottom"
      ChartContent="{Binding Chart}"
      MaxValue="{Binding MaxUnix, Mode=TwoWay}"
      MinValue="{Binding MinUnix, Mode=TwoWay}"
      ResetChart="{Binding ResetChartX}">
      <controls1:HorizontalRuler.Style>
        <Style TargetType="controls1:HorizontalRuler">
          <Style.Triggers>
            <DataTrigger Binding="{Binding DataContext.SelectedBot.IsSimulation, RelativeSource={RelativeSource AncestorType=Window}}" Value="true">
              <Setter Property="Visibility" Value="Hidden" />
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </controls1:HorizontalRuler.Style>
    </controls1:HorizontalRuler>

    <Grid
      Grid.Row="1"
      Grid.ColumnSpan="3"
      Margin="5,5">
      <CheckBox
        Margin="5,0"
        HorizontalAlignment="Right"
        VerticalAlignment="Bottom"
        IsChecked="{Binding LockChart}">
        Lock chart
      </CheckBox>


      <controls:PathButton
        Margin="5,5"
        HorizontalAlignment="Left"
        VerticalAlignment="Bottom"
        Command="{Binding ResetChart}"
        Glyph=""
        IconMargin="0"
        IsReadOnly="True"
        Style="{StaticResource FontAwesomeGlyphStyle}"
        ToolTip="Reset chart" />
    </Grid>
  </Grid>

</UserControl>
